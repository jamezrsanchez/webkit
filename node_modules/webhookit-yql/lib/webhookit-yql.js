var YQL = require('yql');

exports.run = function(params, cb) {

var url = params.url;
var xpath = params.xpath;

var query = "select * from html where url='"+url+"' and xpath='"+xpath+"'";
	new YQL.exec(query, function(response) {
	var itemKey = Object.keys(response.query.results);
        var items = Object.keys(response.query.results);
        console.log('james');
        console.log(response.query.results['li'][0]['div'][0]['a']['content']);
		cb({"out": response.query.results[itemKey]});
		
	}, {}/*, {"https": true}*/);
	
};


exports.definition = {
    "name": "yql",
    "category": "Sources",
    "container": {
        "icon": "/images/module_icons/yql.png",
        "xtype": "WireIt.FormContainer",
        "title": "yql",
        "fields": [
        {
            "type": "string",
            "name": "url",
            "wirable": false,
            label: "Url"
        },
        {
            "type": "string",
            "name": "xpath",
            "wirable": false,
            label: "Xpath"
        }

        ],
        "terminals": [
        {
            "name": "out",
            "direction": [0, 1],
            "offsetPosition": {
                "left": 86,
                "bottom": -15
            },
            "ddConfig": {
                "type": "output",
                "allowedTypes": ["input"]
            }
        }
        ]
    }
};
